---
layout:     post
title:      输出控制
categories: ['PHP']
tag: ['PHP']
description: 
---

先说一段痛苦的调试经历。

最近产品想做一个功能，就是每天定时给公司高层发送平台的数据日报，功能点很简单，写几个查询，然后组织下就好了，后台恰恰有类似的功能（很nice）。

仔细一想，问题来了。后台的统计表时js生成的，我却要发到邮件中。关于php生存统计表的坑请见pchart之坑

差不多花了两天时间把页面做的差不多了，统计表页都弄出来了。我用的是本地存储，上线的前一刻才有人告诉我图片可以传到阿里云oss里，
我一想那不更简单，连创建本地文件都省了（得麻烦运维，对了，我刚到公司两周，各种不熟悉）。

这个时候碰到了一个麻烦事情，pchart提供了保存到文件的方法，也提供了直接输出到页面的方法，就是没有返回文件流动的方法。尝试了很多的方法，比如file_get_contents，file之类的，都不能够成功，原因是因为返回的是一种资源，而oss只能通过文件路径或者文件流上传文件。倒腾了好一会，迫于上线时间压力，只能
先保存到文件中，然后从文件中读出来传到oss。

过了几天，忽然脑子里灵光一闪（其实一直惦记着这事），我可以把输出的内容捕获到，然后上传，于是到网上找类似的方法。果然，就是ob_start函数，官网的解释是：打开输出控制缓冲，简单说就是把将输出到页面上内容保存到缓冲区里，然后通过ob_get_contents这个方法将缓冲区里的内容赋值给变量，然后用ob_end_clean关闭缓冲区。
问题解决了。
